<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0/EN" 
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
		<mapper namespace="team.projectA.mapper.MypageMapper">
		
		<!-- 마이페이지 비밀번호 변경 -->
		<update id="changePw">
			UPDATE AUSERTB
				SET userPassword = #{userPassword}
				WHERE userName = #{userName}
		</update>
		
		<!-- 마이페이지 예약내역 -->
		<select id="reserv_list" resultType="reservVO">
			SELECT *
				FROM reservtb	
		</select> 
		
		<!-- 마이페이지 예약내역 페이징(게시물 총개수 구하기) -->
		<select id="reserv_count" resultType="int">
			SELECT COUNT(reserv_idx) 
				FROM reservtb
				WHERE reserv_idx > 0	
		</select>
		
		<!-- 게시물 목록 + 페이징 -->
		<select id="listPage" parameterType="HashMap" resultType="reservVO">
			SELECT reserv_idx
				,username
				,lodgingname
				,reserv_date
				,reserv_startDate
				,reserv_endDate
				,reserv_num
				,ridx
				,rprice
				,uidx
					FROM (
						SELECT reserv_idx
								,username
								,lodgingname
								,reserv_date
								,reserv_startDate
								,reserv_endDate
								,reserv_num
								,v.ridx
								,rprice
								,u.uidx
						, ROW_NUMBER() 
							OVER(
								ORDER BY reserv_idx desc
								) 
							AS rNum FROM AUSERTB u, LODGINGTB l, ROOMTB r, reservtb v
							WHERE l.lidx = r.LIDX
						   AND r.ridx = v.ridx
						   AND v.uidx = u.uidx
						   AND u.uidx = #{uidx}
						   )rtb 
							WHERE rNum 
							BETWEEN #{rowStart} AND #{rowEnd} 
							ORDER BY reserv_idx DESC
		</select>
		
		<!-- 예약취소 팝업창 -->
		<select id="reservListPop" parameterType="HashMap" resultType="reservVO">
			SELECT lodgingname
					,reserv_num
					,rprice
					FROM AUSERTB u, LODGINGTB l, ROOMTB r, reservtb v
							WHERE l.lidx = r.LIDX
						   AND r.ridx = v.ridx
						   AND v.uidx = u.uidx
						   AND v.ridx = #{ridx}
						   AND v.uidx = #{uidx}
		</select>
		
		<!-- 예약취소 -->
		<delete id="reserv_refund">
			DELETE FROM reservtb
				WHERE reserv_num = #{reserv_num}
		</delete>
		
		
</mapper>



